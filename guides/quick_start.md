# Quick Start

## Overview

1. install `combo_storage`.
2. setup a storage provider.
3. define a definition module.

### Setup a storage provider

`combo_storage` has two built-in storage providers:

- `Combo.Storage.Local`
- `Combo.Storage.S3`

[Other available storage providers](#other-storage-providers)
are supported by the community.

An example for setting up `Combo.Storage.Adapters.Local`:

```elixir
config :waffle,
  storage: Combo.Storage.Adapters.Local
```

### Define a definition module

Waffle requires a **definition module** which contains the relevant
functions to store and retrieve files:

- Optional transformations of the uploaded file
- Where to put your files (the storage directory)
- How to name your files
- How to secure your files (private? Or publicly accessible?)
- Default placeholders

This module can be created manually or generated by `mix waffle.g`
automatically.

As an example, we will generate a definition module for handling
avatars:

    mix waffle.g avatar

This should generate a file at `lib/[APP_NAME]_web/uploaders/avatar.ex`.
Check this file for descriptions of configurable options.

## Examples

- [An example for Local storage driver](documentation/examples/local.md)
- [An example for S3 storage driver](documentation/examples/s3.md)

## Usage with Ecto

Waffle comes with a companion package for use with Ecto. If you
intend to use Waffle with Ecto, it is highly recommended you also
add the
[`waffle_ecto`](https://github.com/elixir-waffle/waffle_ecto)
dependency. Benefits include:

- Changeset integration
- Versioned urls for cache busting (`.../thumb.png?v=63601457477`)

## Testing

The basic test suite can be run with without supplying any S3 information:

```
mix test
```

In order to test S3 capability, you must have access to an S3/equivalent bucket. For
S3 buckets, the bucket must be configured to allow ACLs and it must allow public
access.

The following environment variables will be used by the test suite:

- WAFFLE_TEST_BUCKET
- WAFFLE_TEST_BUCKET2
- WAFFLE_TEST_S3_KEY
- WAFFLE_TEST_S3_SECRET
- WAFFLE_TEST_REGION

After setting these variables, you can run the full test suite with `mix test --include s3:true`.
